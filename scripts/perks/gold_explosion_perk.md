---
title: Gold Explosion Perk
category: scripts/perks
---

# Gold Explosion Perk

This script defines the behavior for the "Gold Explosion" perk in Noita. When picked up, it grants the player the ability to cause an explosion of gold particles upon collecting gold.

## Key Functionality

*   **Perk Activation:** The script is triggered when the `exploding_gold` game flag is active, indicating the perk has been acquired.
*   **Entity Spawning:** It spawns a `gold_explosion.xml` entity as a child of the player's entity. This entity is responsible for the visual and functional aspects of the explosion.
*   **Gold Value Calculation:** The script retrieves the player's current gold value from a `VariableStorageComponent`. This value directly influences the explosion's properties.
*   **Explosion Parameter Tuning:** The core of the perk's effect lies in dynamically calculating explosion parameters based on the collected gold and the number of times the perk has been picked up.

## Key Attributes & Calculations

The following attributes are dynamically calculated and applied to the explosion entity:

### Explosion Radius

Determines the area of effect for the gold explosion.

*   **Formula:** `( value / ( 10 + value * 0.01 ) ) + math.min( 60, ( 16 + ( pickup_count - 1 ) * 4 ) )`
*   **Influences:**
    *   `value`: The player's current gold amount.
    *   `pickup_count`: The number of times the "Exploding Gold" perk has been picked up.

### Explosion Damage

Calculates the damage dealt by the gold explosion.

*   **Formula:** `( ( value / ( 10 + value * 0.01 ) ) + 1.5 ) * math.min( 2.0, ( 0.4 + ( pickup_count - 1 ) * 0.2 ) )`
*   **Influences:**
    *   `value`: The player's current gold amount.
    *   `pickup_count`: The number of times the "Exploding Gold" perk has been picked up.

### Spark Count

Determines the minimum and maximum number of sparks generated by the explosion.

*   **`exp_sparks_min` Formula:** `math.max( 5, math.floor( exp_radius * 0.75 ) )`
*   **`exp_sparks_max` Formula:** `math.max( 10, math.floor( exp_radius * 1.25 ) )`
*   **Influences:**
    *   `exp_radius`: The calculated explosion radius.

### Shooter Identification

Ensures the explosion originates from the player and doesn't damage them.

*   **`mWhoShot`:** Set to the player's entity ID.
*   **`mShooterHerdId`:** Set to the player's herd ID.
*   **`dont_damage_this`:** Set to the player's entity ID to prevent self-damage.

## Internal Variables

| Variable Name     | Type    | Description                                                                 |
| :---------------- | :------ | :-------------------------------------------------------------------------- |
| `entity_id`       | number  | The ID of the entity that triggered the perk (usually the player).          |
| `eid`             | number  | The ID of the spawned `gold_explosion.xml` entity.                          |
| `value`           | number  | The player's current gold amount.                                           |
| `comps`           | table   | A table of components attached to the triggering entity.                    |
| `players`         | table   | A list of entities tagged as "player_unit".                                 |
| `player`          | entity  | The primary player entity.                                                  |
| `herd_id`         | number  | The herd ID of the player.                                                  |
| `flag_name`       | string  | The global flag name used to track perk pickups (`PERK_PICKED_EXPLODING_GOLD`). |
| `pickup_count`    | number  | The total number of times the "Exploding Gold" perk has been picked up.     |
| `exp_radius`      | number  | The calculated radius of the gold explosion.                                |
| `exp_damage`      | number  | The calculated damage of the gold explosion.                                |
| `exp_sparks_min`  | number  | The minimum number of sparks generated by the explosion.                    |
| `exp_sparks_max`  | number  | The maximum number of sparks generated by the explosion.                    |

## Related Files

*   `data/entities/misc/perks/gold_explosion.xml`: The entity definition for the gold explosion effect.
*   `data/scripts/lib/utilities.lua`: Contains utility functions used in this script.